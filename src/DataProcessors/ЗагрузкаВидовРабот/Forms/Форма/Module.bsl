
&НаСервере
Процедура ЗагрузитьНаСервере(ТО,ВР)
Запрос = Новый Запрос;

ТехОперация = Справочники.ТехОперации.ПустаяСсылка();
Запрос.Текст = 
	"ВЫБРАТЬ
	|	ТехОперации.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.ТехОперации КАК ТехОперации
	|ГДЕ
	|	ТехОперации.Наименование ПОДОБНО &Наименование
	|	И ТехОперации.ЭтоГруппа = ЛОЖЬ";
Запрос.УстановитьПараметр("ВидРабот", ВР);
Запрос.УстановитьПараметр("Наименование", ТО+"%");
РезультатЗапроса = Запрос.Выполнить();
ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
	ТехОперация = ВыборкаДетальныеЗаписи.Ссылка;
	КонецЦикла;
		Если Не ТехОперация.Пустая() Тогда
			Попытка	
			НачатьТранзакцию();ПараметрыСеанса.АктивнаТранзакция = ПараметрыСеанса.АктивнаТранзакция + 1;
			ВидРабот = Справочники.ВидыРабот.НайтиПоНаименованию(ВР,Истина);
				Если ВидРабот.Пустая() Тогда
				ВидРабот = Справочники.ВидыРабот.СоздатьЭлемент();
				ВидРабот.Наименование = ВР;
				ВидРабот.Записать();
				КонецЕсли;			
			ТО_Объект = ТехОперация.ПолучитьОбъект();
			ТО_Объект.ВидРабот = ВидРабот.Ссылка;
			ТО_Объект.Записать();
			ЗафиксироватьТранзакцию();ПараметрыСеанса.АктивнаТранзакция = ПараметрыСеанса.АктивнаТранзакция-1;Если ПараметрыСеанса.АктивнаТранзакция = 0 тогда СРМ_ОбменВебСервис.ОтправкаПослеТранзакции();КонецЕсли;
			Исключение
			Сообщить(ОписаниеОшибки());
			ОтменитьТранзакцию();ПараметрыСеанса.АктивнаТранзакция = ПараметрыСеанса.АктивнаТранзакция-1;ПараметрыСеанса.ОбъектыСозданныеВТранзакции = Новый ХранилищеЗначения(Новый Массив);	
			КонецПопытки;		
		Иначе	
		Сообщить(ТО + " - не найдена в справочнике тех. операций!");
		КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура Загрузить(Команда)
Результат = ОбщийМодульКлиент.ОткрытьФайлExcel("Выберите файл c видами работ для ТО");
	Если Результат <> Неопределено Тогда
	СЗ = Новый СписокЗначений;

	ExcelЛист = Результат.ExcelЛист;
	КолСтрок = Результат.КоличествоСтрок;
	    Для к = 1 по КолСтрок Цикл
		Состояние("Обработка...",к*100/КолСтрок,"Загрузка видов работ из файла...");
       	ЗагрузитьНаСервере(СокрЛП(ExcelЛист.Cells(к,1).Value),СокрЛП(ExcelЛист.Cells(к,2).Value));
	    КонецЦикла;
	Результат.Excel.Quit();
	КонецЕсли;
КонецПроцедуры
